---
phase: 05-gap-closure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/canvas/edges/DimensionEdge.tsx
  - src/canvas/nodes/TypeCardNode.tsx
  - src/App.tsx
autonomous: false
requirements:
  - INT-05

must_haves:
  truths:
    - "Edge arrowheads visually connect to card row handles without visible offset or gap"
    - "Breadcrumb trail is not visible in the UI"
    - "Esc key still exits subgraph navigation (INT-05 unaffected)"
    - "Browser back button still exits subgraph navigation (INT-05 unaffected)"
  artifacts:
    - path: "src/canvas/edges/DimensionEdge.tsx"
      provides: "Corrected marker refX/refY or edge path endpoints"
    - path: "src/canvas/nodes/TypeCardNode.tsx"
      provides: "Handle positioning aligned with edge endpoints"
    - path: "src/App.tsx"
      provides: "Breadcrumb hidden from render tree"
  key_links:
    - from: "src/canvas/edges/DimensionEdge.tsx"
      to: "src/canvas/nodes/TypeCardNode.tsx"
      via: "Handle positions determine where edge paths terminate"
      pattern: "Handle.*id=.*__target|__source"
---

<objective>
Fix edge arrow connection points that shifted after Phase 3 restyle, and hide the breadcrumb trail from the UI.

Purpose: The Phase 3 restyle changed card padding, font sizes, and border widths, which shifted Handle DOM positions relative to ELK-computed route endpoints. The breadcrumb component is redundant now that Esc/back/inspect-panel provide navigation.

Output: Visually aligned edge arrows, breadcrumb hidden from UI.
</objective>

<execution_context>
@/Users/thedoc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thedoc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-gap-closure/05-RESEARCH.md
@src/canvas/edges/DimensionEdge.tsx
@src/canvas/nodes/TypeCardNode.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix edge arrow alignment and hide breadcrumb</name>
  <files>src/canvas/edges/DimensionEdge.tsx, src/canvas/nodes/TypeCardNode.tsx, src/App.tsx</files>
  <action>
**Edge alignment fix:**
1. Start dev server (`npm run dev`), open in browser, inspect the edge arrow misalignment visually
2. Use browser DevTools to inspect `.react-flow__handle` elements on a TypeCardNode card -- compare their computed DOM positions to where edge paths terminate
3. The root cause is that ELK route endpoints and React Flow Handle DOM positions are computed independently. Phase 3 changed card padding (`px-3 py-1.5` header, `px-3 py-0.5` rows), font sizes, and borders, which shifted Handle positions
4. Determine which of these fixes is needed (may be one or a combination):
   - **Marker adjustment:** Change `refX` and/or `refY` values on the SVG marker in `DimensionEdge.tsx` (currently `refX={8} refY={4}` with `viewBox="0 0 8 8"`) to compensate for the offset
   - **Handle positioning:** Adjust the `hiddenHandle` style in `TypeCardNode.tsx` (currently `opacity: 0, width: 6, height: 6`) -- may need explicit positioning or size changes to center Handles correctly within their flex containers
   - **Both:** If the ELK route endpoints diverge from Handle centers, the fix may require aligning both the marker offset AND Handle positioning
5. After the fix, verify edges connect cleanly to card rows on both TB and LR layout directions

**Breadcrumb hide:**
1. In `src/App.tsx`, remove the `<Breadcrumb />` component from the render tree (line 110)
2. Remove the `import Breadcrumb from "./canvas/Breadcrumb"` import (line 3)
3. Do NOT delete `src/canvas/Breadcrumb.tsx` -- keep the file for potential Phase 4 use
4. Verify Esc key and browser back button still work for subgraph navigation (the handlers are in the same file at lines 34-41 and 72-81 and must remain untouched)
  </action>
  <verify>
1. `npm run build` passes clean
2. `npm run lint` passes clean
3. Visual check: edges connect to card handles without visible gap/offset in both TB and LR layout
4. Visual check: breadcrumb trail is not visible anywhere in the UI
5. Functional check: Esc key exits subgraph, browser back exits subgraph
  </verify>
  <done>Edge arrows visually connect flush to card row handles with no offset in both TB and LR. Breadcrumb is not rendered. Esc and back button navigation still works.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify edge alignment and breadcrumb removal</name>
  <files>n/a</files>
  <action>
Human verification checkpoint. Ensure dev server is running (`npm run dev`).

**What was built:** Fixed edge arrow connection points shifted by Phase 3 restyle, hidden breadcrumb trail from UI.

**How to verify:**
1. Open http://localhost:5173 with the default model
2. Check edges: arrows should connect cleanly to card row handles, no visible gap or offset
3. Toggle layout direction (TB vs LR) and verify edges connect correctly in both directions
4. Check that the breadcrumb trail is NOT visible anywhere in the UI
5. Navigate into a subgraph (click a permission row), then press Esc -- should return to full graph
6. Navigate into a subgraph again, then press browser Back -- should return to full graph
7. Navigate two levels deep, press Esc twice -- should return to full graph

**Resume signal:** Type "approved" or describe issues to fix
  </action>
  <verify>User confirms visual alignment and functional navigation</verify>
  <done>User approves edge alignment and breadcrumb removal</done>
</task>

</tasks>

<verification>
- `npm run build` passes with zero errors
- `npm run lint` passes with zero warnings/errors
- Edge arrows visually aligned in both TB and LR layout directions
- Breadcrumb not visible in UI
- Esc key and browser back still navigate subgraphs correctly
</verification>

<success_criteria>
Edge arrow connection points are visually flush with card row handles in both layout directions. Breadcrumb trail is hidden from the UI. INT-05 (Esc/back exits subgraph) is unaffected.
</success_criteria>

<output>
After completion, create `.planning/phases/05-gap-closure/05-01-SUMMARY.md`
</output>
