---
phase: 03-visual-refinement
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/canvas/nodes/TypeCardNode.tsx
  - src/canvas/FgaGraph.tsx
  - src/canvas/Canvas.tsx
  - src/canvas/Breadcrumb.tsx
  - src/canvas/edges/DimensionEdge.tsx
  - src/components/Tooltip.tsx
  - src/components/ResizeHandle.tsx
  - src/App.tsx
  - src/index.css
autonomous: true
requirements:
  - THEME-03
  - THEME-04
  - THEME-05
  - THEME-08

must_haves:
  truths:
    - "Cards display as elevated solid surfaces with bottom-border headers and 1px section separators -- no glass/blur, no accent bars"
    - "Canvas dot grid uses warm neutral color, MiniMap and Controls use warm styling"
    - "Dimension edges are muted by default (~0.35 opacity) and vivid on hover/select"
    - "Section-coded dots use different neutral shades for binding, relation, and permission rows"
  artifacts:
    - path: "src/canvas/nodes/TypeCardNode.tsx"
      provides: "Solid surface card with bottom-border header, section separators, section dots"
    - path: "src/canvas/FgaGraph.tsx"
      provides: "Warm dot grid, warm MiniMap/Controls"
    - path: "src/canvas/edges/DimensionEdge.tsx"
      provides: "Muted default opacity, vivid on hover"
  key_links:
    - from: "src/canvas/nodes/TypeCardNode.tsx"
      to: "src/index.css"
      via: "var(--color-*) and var(--color-dot-*) token references"
      pattern: "var\\(--color-"
    - from: "src/canvas/edges/DimensionEdge.tsx"
      to: "hover-store"
      via: "opacity changes from 0.35 default to 1.0 on highlight"
      pattern: "opacity"
---

<objective>
Restyle the canvas surface (dot grid, MiniMap, Controls), ERD schema cards (solid surface, section separators, section dots), dimension edges (muted default), and remaining UI surfaces (Breadcrumb, Tooltip, ResizeHandle, App banner) to use the warm token palette established in Plan 01.

Purpose: Transform the visual appearance from cold blue glass aesthetic to Linear/Vercel-quality warm dark devtool look. This is the most visible change -- cards and canvas are the primary UI.

Output: All canvas and card components render with warm neutral tones, solid surfaces, and muted dimension edges.
</objective>

<execution_context>
@/Users/thedoc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thedoc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-visual-refinement/03-RESEARCH.md
@.planning/phases/03-visual-refinement/03-01-SUMMARY.md
@src/canvas/nodes/TypeCardNode.tsx
@src/canvas/FgaGraph.tsx
@src/canvas/edges/DimensionEdge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restyle TypeCardNode -- solid surface, section separators, section dots</name>
  <files>
    src/canvas/nodes/TypeCardNode.tsx
  </files>
  <action>
Apply the full card restyle per locked decisions:

**Header:**
- Remove the colored accent bar (`borderTop: 3px solid ...`). Header should have NO top accent bar and NO different background color from the card body.
- Add `borderBottom: 1px solid var(--color-border)` as the header separator.
- Header text color: `var(--color-text-primary)`.
- Collapsed badge (row count) should use `var(--color-text-muted)` for the count text.

**Card body:**
- Background: `var(--color-surface-raised)` -- solid, no glass/blur. Remove any `backdropFilter: blur(...)` and `rgba(...)` semi-transparent backgrounds.
- Border: `1px solid var(--color-border)`.
- A subtle frosting is acceptable (e.g., very slight `backdrop-filter: blur(2px)`) but NOT the heavy `blur(8px)` that currently exists. Claude's discretion on whether to keep a hint or remove entirely.
- `border-radius` stays at whatever current rounded value is (likely `rounded-xl` / 12px).

**Section separators:**
- Between binding/relation/permission sections, add a `1px solid var(--color-border-subtle)` separator line. Only between non-empty sections.

**Section-coded dots:**
- Binding row dots: use `var(--color-dot-binding)` (currently they use `dimensionColor` -- KEEP dimension colors for binding dots, this is functional not decorative).
- Relation row dots (the circle icon): use `var(--color-dot-relation)` shade.
- Permission row dots (the diamond icon): use `var(--color-dot-permission)` shade.
- These are the neutral section-type indicators, NOT the dimension colors. The dimension color on binding dots is a separate concern and stays.

**Row text:**
- Row name text: `var(--color-text-secondary)`.
- Expression text: `var(--color-text-muted)`.
- Keep current row density (`py-0.5`).

**Typography:**
- Ensure all text in the card uses monospace font (it should already via the global `font-family` on html/body, but verify no overrides exist).
- Use Tailwind type scale levels only (`text-xs`, `text-sm`, etc.) -- no arbitrary `text-[Npx]` values. If any exist, replace with nearest Tailwind level.
  </action>
  <verify>
`npm run build` passes. Load app in browser -- cards should show solid dark surface with bottom-border header separator, section separator lines, warm text colors. No blue tint. No colored accent bar at top of cards.
  </verify>
  <done>
Cards render as elevated solid surfaces. Headers have bottom border separator only. Sections separated by subtle lines. Section dots use neutral shades. No glass/blur. No accent bars. No blue tint.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restyle canvas, edges, and remaining surfaces</name>
  <files>
    src/canvas/FgaGraph.tsx
    src/canvas/Canvas.tsx
    src/canvas/Breadcrumb.tsx
    src/canvas/edges/DimensionEdge.tsx
    src/components/Tooltip.tsx
    src/components/ResizeHandle.tsx
    src/App.tsx
    src/index.css
  </files>
  <action>
**Canvas (`FgaGraph.tsx`):**
- `<Background>` dot color: change from `#1e3a5c` (cold blue) to `var(--color-dot-grid)` or the warm equivalent `#222222`.
- `<MiniMap>` style: background `rgba(17, 17, 17, 0.95)`, border `1px solid var(--color-border)`, maskColor `rgba(17, 17, 17, 0.7)`, nodeColor `#333333`.
- `<Controls>` style: background `rgba(17, 17, 17, 0.95)`, border `1px solid var(--color-border)`.

**Edge muting (`DimensionEdge.tsx`):**
- Default (non-hovered, non-highlighted) edge opacity: reduce from current value (~0.6) to `0.35`.
- Hover/highlight opacity: full `1.0`.
- Edge stroke width: ensure `1.5px` to `2px` range (medium weight per locked decision).
- Type restriction edges keep their muted slate color but at the same reduced default opacity.

**Canvas empty state (`Canvas.tsx`):**
- Replace any hardcoded cold blue colors with warm token references.

**Breadcrumb (`Breadcrumb.tsx`):**
- All colors should reference `var(--color-*)` tokens. Background of breadcrumb container: `var(--color-surface-overlay)` or similar. Text: `var(--color-text-secondary)`, active item: `var(--color-text-primary)`, separator: `var(--color-text-muted)`.

**Tooltip (`Tooltip.tsx`):**
- Replace hardcoded colors with warm token references. Background: `var(--color-surface-overlay)`, border: `var(--color-border)`, text: `var(--color-text-secondary)`.

**ResizeHandle (`ResizeHandle.tsx`):**
- Replace all color references with warm tokens.

**App banner (`App.tsx`):**
- Replace `#1a1a2e` and `#f59e0b` with warm token references. Banner background: `var(--color-surface)`, accent elements: `var(--color-accent)`.

**HUD panel CSS (`index.css`):**
- Verify `.hud-panel` uses warm values (should be done in Plan 01, but double-check): `rgba(17, 17, 17, 0.95)`, border `var(--color-border)`.
  </action>
  <verify>
`npm run build` passes. Load app in browser -- canvas shows warm dot grid, MiniMap/Controls have warm styling. Edges are muted by default but brighten on hover. Breadcrumb, tooltips, and App banner all use warm neutral tones. Zero blue tint visible anywhere on the canvas.
  </verify>
  <done>
Canvas dot grid is warm. MiniMap/Controls are warm. Edges muted at 0.35 default opacity, vivid on hover. Breadcrumb, Tooltip, ResizeHandle, and App banner all use warm tokens. No blue tint on any surface.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. Cards show solid surface, bottom-border header, section separators
3. No glass/blur effect on cards (or only very subtle frosting)
4. Canvas dot grid is warm neutral (not blue)
5. Edges are clearly muted by default, vivid on hover
6. All text is monospace
7. No arbitrary `text-[Npx]` values in modified files
8. `grep -r "#0f1729\|#1a2640\|#2a3a5c\|#1e3a5c\|#162033" src/` returns nothing
</verification>

<success_criteria>
- Cards render as elevated solid surfaces with bottom-border headers and section separators
- Canvas and all controls use warm neutral palette
- Dimension edges are muted by default, vivid on interaction
- All remaining surface components use warm tokens
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/03-visual-refinement/03-02-SUMMARY.md`
</output>
