---
phase: 02-interaction-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/theme/colors.ts
  - src/index.css
  - src/App.tsx
  - src/toolbar/Toolbar.tsx
  - src/editor/EditorPanel.tsx
  - src/components/ResizeHandle.tsx
  - src/canvas/FgaGraph.tsx
  - src/legend/LegendPanel.tsx
autonomous: true
requirements: [CTRL-06]

must_haves:
  truths:
    - "Primary accent color is mustard throughout the UI (toolbar, active states, highlights)"
    - "Canvas background shows subtle dot grid pattern providing spatial reference"
    - "Toolbar is a floating pill centered at the top of the canvas with solid dark background and mustard accents"
    - "Editor slides out as an overlay from the left edge without resizing the canvas"
    - "Editor is open by default on page load"
    - "MiniMap and Controls are restyled with solid dark HUD aesthetic"
    - "LegendPanel is deleted (replaced by inspect panel in later plan)"
    - "All new UI panels use solid dark backgrounds (no glass transparency)"
  artifacts:
    - path: "src/theme/colors.ts"
      provides: "Mustard accent color in blueprint object"
      contains: "accent"
    - path: "src/index.css"
      provides: "HUD panel class with solid dark background, dot grid vars"
      contains: "hud-panel"
    - path: "src/App.tsx"
      provides: "Overlay-based layout (canvas full viewport, editor/toolbar/etc overlaid)"
    - path: "src/toolbar/Toolbar.tsx"
      provides: "Floating pill toolbar at top center with HUD aesthetic"
    - path: "src/editor/EditorPanel.tsx"
      provides: "Slide-out overlay panel from left edge"
  key_links:
    - from: "src/theme/colors.ts"
      to: "src/toolbar/Toolbar.tsx"
      via: "blueprint.accent import"
      pattern: "blueprint\\.accent"
    - from: "src/App.tsx"
      to: "src/editor/EditorPanel.tsx"
      via: "overlay positioning"
      pattern: "absolute|fixed|z-"
---

<objective>
Establish the HUD visual identity and restructure the application layout from a flex-row split to an overlay-based stack. Mustard accent color, floating pill toolbar at top, editor as left-side overlay, solid dark panels, dot grid canvas, restyled minimap/controls.

Purpose: Creates the visual foundation that all subsequent Phase 2 features (inspect panel, breadcrumb, command palette) will inherit. Without this, new panels would clash with the old layout model.

Output: Restyled application with HUD aesthetic, overlay layout, and deleted legend panel.
</objective>

<execution_context>
@/Users/thedoc/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thedoc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-interaction-polish/02-CONTEXT.md
@.planning/phases/02-interaction-polish/02-RESEARCH.md

@src/theme/colors.ts
@src/index.css
@src/App.tsx
@src/toolbar/Toolbar.tsx
@src/editor/EditorPanel.tsx
@src/components/ResizeHandle.tsx
@src/canvas/FgaGraph.tsx
@src/legend/LegendPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: HUD theme, overlay layout, and toolbar redesign</name>
  <files>
    src/theme/colors.ts
    src/index.css
    src/App.tsx
    src/toolbar/Toolbar.tsx
    src/editor/EditorPanel.tsx
    src/components/ResizeHandle.tsx
    src/canvas/FgaGraph.tsx
  </files>
  <action>
    **Theme changes (src/theme/colors.ts):**
    - Change `blueprint.accent` from `"#38bdf8"` (sky blue) to `"#d4a017"` (mustard). This is a single-point-of-change; all components already import `blueprint.accent`.

    **CSS changes (src/index.css):**
    - Update `.hud-panel` class to use solid dark background instead of glass transparency: `background: rgba(15, 23, 41, 0.95)` (increase opacity from 0.9), keep `backdrop-filter: blur(12px)`, keep existing border and shadow.
    - The dot grid Background is already rendered via React Flow's `<Background variant={BackgroundVariant.Dots}>` in FgaGraph.tsx -- adjust the color prop there to use a muted slate that complements the HUD aesthetic.

    **Layout restructure (src/App.tsx):**
    - Change from flex-row layout (`EditorPanel | ResizeHandle | Canvas`) to overlay-based stack.
    - Canvas takes full viewport. EditorPanel and Toolbar are positioned as absolute/fixed overlays.
    - New structure:
      ```
      <div className="relative w-screen h-screen overflow-hidden">
        {alphaBanner}
        <Canvas />          {/* Full viewport */}
        <EditorOverlay />   {/* Positioned absolute left, z-40 */}
        <Toolbar />         {/* Positioned absolute top-center, z-50 */}
      </div>
      ```
    - Remove `ResizeHandle` usage from the layout (it's no longer needed since editor overlays).
    - Remove `LegendPanel` import and rendering from App.tsx.
    - Remove `legendOpen` and `toggleLegend` store subscriptions from App.tsx.
    - Keep all existing keyboard shortcuts (Cmd+E for editor, Cmd+K for search, Esc).

    **Editor as overlay (src/editor/EditorPanel.tsx):**
    - Change from flex child to absolute-positioned overlay on the left edge.
    - Position: `position: absolute; left: 0; top: 0; bottom: 0; z-index: 40`.
    - When closed: slide off-screen to the left (`transform: translateX(-100%)`).
    - When open: slide in (`transform: translateX(0)`).
    - Use CSS transition on transform (250ms ease-out, same timing as current width transition).
    - Keep the editor header, FgaEditor content, and parse error display.
    - Set a fixed width (e.g., 480px) instead of the resizable `editorWidth` -- overlays don't need resize since they don't affect canvas.
    - Add a subtle shadow on the right edge when open for depth.
    - Use solid dark background consistent with HUD panels: `background: rgba(15, 23, 41, 0.95)`.

    **Toolbar redesign (src/toolbar/Toolbar.tsx):**
    - Move toolbar from `bottom-4` to `top-4` position (floating pill at top center per CONTEXT.md).
    - Add `border-radius: 9999px` (full pill shape).
    - Remove legend toggle button entirely (legend is deleted).
    - Remove `legendOpen` and `toggleLegend` store subscriptions.
    - Keep: search button, fit view button, import button, GitHub button.
    - Keep: permissions-only toggle button.
    - Update ToolbarButton hover/active states to use the new mustard accent (already happens automatically via `blueprint.accent`).
    - Add editor toggle button (code icon) next to search -- `onClick={toggleEditor}`, subscribe to `editorOpen` for active state.
    - Add keyboard hint `Cmd+E` next to editor toggle, similar to the `Cmd+K` hint for search.

    **ResizeHandle (src/components/ResizeHandle.tsx):**
    - This component is no longer needed in the overlay layout. Leave the file in place but remove its usage from App.tsx. It can be deleted later if desired.

    **MiniMap and Controls restyle (src/canvas/FgaGraph.tsx):**
    - Update MiniMap inline styles: solid dark background `rgba(15, 23, 41, 0.95)`, border `1px solid #2a3a5c`.
    - Update Controls inline styles: same solid dark background, matching border.
    - Update Background component: color `#1e3a5c` (slightly brighter for visibility), gap `24`, size `1` for subtle dot grid.

    **Important constraints:**
    - ERD cards keep their current dark glass styling unchanged (per CONTEXT.md).
    - Do NOT add framer-motion or any animation library -- use CSS transitions only.
    - Do NOT change the Canvas component itself -- only its parent layout in App.tsx.
  </action>
  <verify>
    Run `npm run build` -- must compile without errors.
    Run `npm run lint` -- must pass.
    Visually: toolbar at top center with pill shape, mustard accent color on active states, editor slides from left, dot grid background visible, minimap/controls have solid dark styling.
  </verify>
  <done>
    Application displays HUD aesthetic: mustard accent, floating pill toolbar at top, editor as left overlay, dot grid canvas, solid dark MiniMap/Controls. Legend panel removed from layout. Build and lint pass clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete LegendPanel and clean up dead references</name>
  <files>
    src/legend/LegendPanel.tsx
    src/store/viewer-store.ts
  </files>
  <action>
    **Delete legend panel:**
    - Delete `src/legend/LegendPanel.tsx` file entirely.
    - Optionally delete the `src/legend/` directory if empty after deletion.

    **Clean up store references:**
    - In `src/store/viewer-store.ts`: remove `legendOpen: boolean` from ViewerStore interface.
    - Remove `toggleLegend: () => void` from ViewerStore interface.
    - Remove `legendOpen: false` from initial state.
    - Remove `toggleLegend` action implementation.
    - These are now dead code since the legend is replaced by the inspect panel (Plan 02-06).

    **Verify no dangling imports:**
    - Search for any remaining imports of `LegendPanel` or `legendOpen` or `toggleLegend` across the codebase.
    - Fix or remove any found references.

    **Note:** The Toolbar.tsx legend button was already removed in Task 1. If any references remain in App.tsx from Task 1, clean those up here.
  </action>
  <verify>
    Run `npm run build` -- must compile without errors.
    Run `npm run lint` -- must pass.
    Grep for "LegendPanel", "legendOpen", "toggleLegend" in src/ -- zero results.
  </verify>
  <done>
    LegendPanel component deleted. All references to legendOpen and toggleLegend removed from store and components. No dangling imports. Clean build and lint.
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes with zero errors
- `npm run lint` passes clean
- Toolbar appears at top center of canvas as floating pill with rounded edges
- Active toolbar buttons use mustard color instead of old sky blue
- Editor slides in/out from left edge without resizing canvas
- Canvas occupies full viewport behind overlays
- Dot grid pattern visible on canvas background
- MiniMap and Controls have solid dark styling
- No LegendPanel visible or importable
</verification>

<success_criteria>
1. Mustard accent color (`#d4a017`) is the primary accent throughout UI elements
2. Toolbar is a floating pill at top center with solid dark HUD styling
3. Editor opens as left-side overlay without canvas resize
4. Canvas background shows dot grid pattern
5. MiniMap and Controls match HUD aesthetic
6. LegendPanel fully deleted with no remaining references
7. Build and lint pass clean
</success_criteria>

<output>
After completion, create `.planning/phases/02-interaction-polish/02-01-SUMMARY.md`
</output>
